import{S as R,i as H,s as q,k as m,a as A,q as $,l as v,m as k,c as D,r as E,h as _,n as f,K as T,b,G as h,u as B,B as V,o as Z,f as u,g as C,d as S,t as p,H as x,e as I,w as ee,x as te,y as se,z as le,T as ne,I as oe,J as M}from"../../../chunks/index-e8ce05bb.js";import{p as re}from"../../../chunks/stores-aa7a9cac.js";import{c as O,u as L,g as P,D as ae,b as ie}from"../../../chunks/store-c4ebe61c.js";class ce extends Error{constructor(){super("Could not make an API request to the Discord server, because authorization token is missing or is invalid")}}class _e extends Error{constructor(){super("Could not make an API request to the Discord server, because you are being rate limited")}}class ue{constructor(l){this.token=l}async fetch(l){const n=await fetch(l,{headers:{authorization:this.token}});if(await n.clone().json(),n.status==401)throw ce;if(n.status==429)throw _e;return n}async fetchUser(){return(await this.fetch(`${O}/users/@me`)).json()}async fetchGuilds(){return(await this.fetch(`${O}/users/@me/guilds`)).json()}async updateUserCache(){L.set(await this.fetchUser())}async updateGuildsCache(){P.set(await this.fetchGuilds())}}function fe(a){let l,n,e,t,s,r,o=a[0].name+"",i,c,d,w=a[0].id+"",U;return{c(){l=m("div"),n=m("img"),t=A(),s=m("div"),r=m("p"),i=$(o),c=A(),d=m("p"),U=$(w),this.h()},l(y){l=v(y,"DIV",{class:!0});var g=k(l);n=v(g,"IMG",{class:!0,src:!0,alt:!0}),t=D(g),s=v(g,"DIV",{class:!0});var G=k(s);r=v(G,"P",{class:!0});var j=k(r);i=E(j,o),j.forEach(_),c=D(G),d=v(G,"P",{class:!0});var z=k(d);U=E(z,w),z.forEach(_),G.forEach(_),g.forEach(_),this.h()},h(){f(n,"class","rounded-xl w-10 h-10"),T(n.src,e=a[1])||f(n,"src",e),f(n,"alt","guild icon"),f(r,"class",""),f(d,"class","text-[#60626D] font-medium text-sm"),f(s,"class","flex flex-col"),f(l,"class","text-white text-ellipsis w-60 p-4 rounded-xl items-center gap-3 bg-[#282930] flex flex-row")},m(y,g){b(y,l,g),h(l,n),h(l,t),h(l,s),h(s,r),h(r,i),h(s,c),h(s,d),h(d,U)},p(y,[g]){g&2&&!T(n.src,e=y[1])&&f(n,"src",e),g&1&&o!==(o=y[0].name+"")&&B(i,o),g&1&&w!==(w=y[0].id+"")&&B(U,w)},i:V,o:V,d(y){y&&_(l)}}}function he(a,l,n){let{guild:e}=l,t=`https://cdn.discordapp.com/icons/${e.id}/${e.icon}.webp?size=40`;return Z(async()=>{(await fetch(t,{method:"get"})).status==404&&n(1,t=`${ae}/assets/discord.png`)}),e.name.length>18&&(e.name=e.name.slice(0,14)+"..."),a.$$set=s=>{"guild"in s&&n(0,e=s.guild)},[e,t]}class de extends R{constructor(l){super(),H(this,l,he,fe,q,{guild:0})}}function J(a,l,n){const e=a.slice();return e[2]=l[n],e[4]=n,e}function N(a,l,n){const e=a.slice();return e[2]=l[n],e[6]=n,e}function W(a){let l,n,e,t=Array(a[1]),s=[];for(let o=0;o<t.length;o+=1)s[o]=K(N(a,t,o));const r=o=>p(s[o],1,1,()=>{s[o]=null});return{c(){l=m("div");for(let o=0;o<s.length;o+=1)s[o].c();n=A(),this.h()},l(o){l=v(o,"DIV",{class:!0});var i=k(l);for(let c=0;c<s.length;c+=1)s[c].l(i);n=D(i),i.forEach(_),this.h()},h(){f(l,"class","flex flex-row gap-2")},m(o,i){b(o,l,i);for(let c=0;c<s.length;c+=1)s[c].m(l,null);h(l,n),e=!0},p(o,i){if(i&3){t=Array(o[1]);let c;for(c=0;c<t.length;c+=1){const d=N(o,t,c);s[c]?(s[c].p(d,i),u(s[c],1)):(s[c]=K(d),s[c].c(),u(s[c],1),s[c].m(l,n))}for(C(),c=t.length;c<s.length;c+=1)r(c);S()}},i(o){if(!e){for(let i=0;i<t.length;i+=1)u(s[i]);e=!0}},o(o){s=s.filter(Boolean);for(let i=0;i<s.length;i+=1)p(s[i]);e=!1},d(o){o&&_(l),x(s,o)}}}function F(a){let l,n;return l=new de({props:{guild:a[0][a[4]/a[1]*a[1]+a[6]]}}),{c(){ee(l.$$.fragment)},l(e){te(l.$$.fragment,e)},m(e,t){se(l,e,t),n=!0},p(e,t){const s={};t&3&&(s.guild=e[0][e[4]/e[1]*e[1]+e[6]]),l.$set(s)},i(e){n||(u(l.$$.fragment,e),n=!0)},o(e){p(l.$$.fragment,e),n=!1},d(e){le(l,e)}}}function K(a){let l,n,e=a[0][a[4]/a[1]*a[1]+a[6]]&&F(a);return{c(){e&&e.c(),l=I()},l(t){e&&e.l(t),l=I()},m(t,s){e&&e.m(t,s),b(t,l,s),n=!0},p(t,s){t[0][t[4]/t[1]*t[1]+t[6]]?e?(e.p(t,s),s&3&&u(e,1)):(e=F(t),e.c(),u(e,1),e.m(l.parentNode,l)):e&&(C(),p(e,1,1,()=>{e=null}),S())},i(t){n||(u(e),n=!0)},o(t){p(e),n=!1},d(t){e&&e.d(t),t&&_(l)}}}function Q(a){let l,n,e=a[4]%a[1]===0&&W(a);return{c(){e&&e.c(),l=I()},l(t){e&&e.l(t),l=I()},m(t,s){e&&e.m(t,s),b(t,l,s),n=!0},p(t,s){t[4]%t[1]===0?e?(e.p(t,s),s&2&&u(e,1)):(e=W(t),e.c(),u(e,1),e.m(l.parentNode,l)):e&&(C(),p(e,1,1,()=>{e=null}),S())},i(t){n||(u(e),n=!0)},o(t){p(e),n=!1},d(t){e&&e.d(t),t&&_(l)}}}function pe(a){let l,n,e=a[0],t=[];for(let r=0;r<e.length;r+=1)t[r]=Q(J(a,e,r));const s=r=>p(t[r],1,1,()=>{t[r]=null});return{c(){l=m("div");for(let r=0;r<t.length;r+=1)t[r].c();this.h()},l(r){l=v(r,"DIV",{class:!0});var o=k(l);for(let i=0;i<t.length;i+=1)t[i].l(o);o.forEach(_),this.h()},h(){f(l,"class","flex flex-col gap-2")},m(r,o){b(r,l,o);for(let i=0;i<t.length;i+=1)t[i].m(l,null);n=!0},p(r,[o]){if(o&3){e=r[0];let i;for(i=0;i<e.length;i+=1){const c=J(r,e,i);t[i]?(t[i].p(c,o),u(t[i],1)):(t[i]=Q(c),t[i].c(),u(t[i],1),t[i].m(l,null))}for(C(),i=e.length;i<t.length;i+=1)s(i);S()}},i(r){if(!n){for(let o=0;o<e.length;o+=1)u(t[o]);n=!0}},o(r){t=t.filter(Boolean);for(let o=0;o<t.length;o+=1)p(t[o]);n=!1},d(r){r&&_(l),x(t,r)}}}function ge(a,l,n){let{guilds:e}=l,{columns:t=4}=l;return a.$$set=s=>{"guilds"in s&&n(0,e=s.guilds),"columns"in s&&n(1,t=s.columns)},[e,t]}class me extends R{constructor(l){super(),H(this,l,ge,pe,q,{guilds:0,columns:1})}}function X(a){let l,n,e,t=a[0]!=null&&Y(a);return n=new me({props:{guilds:a[1]}}),{c(){t&&t.c(),l=A(),ee(n.$$.fragment)},l(s){t&&t.l(s),l=D(s),te(n.$$.fragment,s)},m(s,r){t&&t.m(s,r),b(s,l,r),se(n,s,r),e=!0},p(s,r){s[0]!=null?t?t.p(s,r):(t=Y(s),t.c(),t.m(l.parentNode,l)):t&&(t.d(1),t=null);const o={};r&2&&(o.guilds=s[1]),n.$set(o)},i(s){e||(u(n.$$.fragment,s),e=!0)},o(s){p(n.$$.fragment,s),e=!1},d(s){t&&t.d(s),s&&_(l),le(n,s)}}}function Y(a){let l,n,e=a[0].username+"",t,s;return{c(){l=m("h1"),n=$("Hey, "),t=$(e),s=$("!"),this.h()},l(r){l=v(r,"H1",{class:!0});var o=k(l);n=E(o,"Hey, "),t=E(o,e),s=E(o,"!"),o.forEach(_),this.h()},h(){f(l,"class","text-white text-4xl")},m(r,o){b(r,l,o),h(l,n),h(l,t),h(l,s)},p(r,o){o&1&&e!==(e=r[0].username+"")&&B(t,e)},d(r){r&&_(l)}}}function ve(a){let l,n,e,t,s=a[1]!=null&&X(a);return{c(){l=m("meta"),n=A(),e=m("div"),s&&s.c(),this.h()},l(r){const o=ne("svelte-bmju4y",document.head);l=v(o,"META",{name:!0,content:!0}),o.forEach(_),n=D(r),e=v(r,"DIV",{class:!0});var i=k(e);s&&s.l(i),i.forEach(_),this.h()},h(){document.title="Dashboard",f(l,"name","description"),f(l,"content","Walty"),f(e,"class","relative w-full justify-center top-[50px] flex flex-col items-center gap-8")},m(r,o){h(document.head,l),b(r,n,o),b(r,e,o),s&&s.m(e,null),t=!0},p(r,[o]){r[1]!=null?s?(s.p(r,o),o&2&&u(s,1)):(s=X(r),s.c(),u(s,1),s.m(e,null)):s&&(C(),p(s,1,1,()=>{s=null}),S())},i(r){t||(u(s),t=!0)},o(r){p(s),t=!1},d(r){_(l),r&&_(n),r&&_(e),s&&s.d()}}}function ye(a,l,n){let e,t,s;oe(a,re,o=>n(3,s=o));const r=!1;return P.subscribe(o=>{n(1,e=o)}),L.subscribe(o=>{n(0,t=o)}),Z(()=>{const o=s.data.session;if(o==null){location.assign(ie);return}const{token_type:i,access_token:c}=o.OAUTH_2,d=`${i} ${c}`;console.log(d);const w=new ue(d);w.updateUserCache(),w.updateGuildsCache()}),n(1,e=M(P)),n(0,t=M(L)),[t,e,r]}class $e extends R{constructor(l){super(),H(this,l,ye,ve,q,{prerender:2})}get prerender(){return this.$$.ctx[2]}}export{$e as default};
